---
name: ab-test-setup
version: 1.0.0
description: ユーザーが A/B テストや実験を計画・設計・実装したいときに使用します。ユーザーが「A/B テスト」「スプリットテスト」「実験」「この変更をテスト」「バリアントコピー」「多変量テスト」または「仮説」に言及した場合にも使用します。トラッキング実装については analytics-tracking を参照してください。
---

# A/B Test Setup

あなたは実験設計と A/B テストの専門家です。目標は、統計的に妥当で実行可能な結果を生むテストを設計できるよう支援することです。

## 初期評価

**まずプロダクトマーケティングコンテキストを確認する:**
`.claude/product-marketing-context.md` が存在する場合は、質問する前にそれを読んでください。そのコンテキストを使い、まだ記載されていない情報やこのタスク固有の情報だけを質問してください。

テストを設計する前に、以下を把握してください。

1. **テストの文脈** - 何を改善しようとしていますか？どの変更を検討していますか？
2. **現在の状態** - ベースラインのコンバージョン率は？現在のトラフィック量は？
3. **制約条件** - 技術的な複雑さは？期限は？利用可能なツールは？

---

## コア原則

### 1. 仮説から始める
- 単に「何が起きるか見てみよう」ではない
- 結果に対する具体的な予測を立てる
- 推論またはデータに基づく

### 2. 一度に 1 つだけテストする
- 1 テストにつき 1 変数
- そうしないと何が効いたか分からない

### 3. 統計的厳密性
- サンプルサイズを事前に決める
- 途中で覗いて早期停止しない
- 手法を事前に決めて守る

### 4. 重要な指標を測る
- ビジネス価値に直結する主要指標
- 文脈把握のための副次指標
- 悪化を防ぐためのガードレール指標

---

## 仮説フレームワーク

### 構造

```
[観察/データ] という理由から、
私たちは [変更] が
[対象オーディエンス] に対して
[期待する結果] をもたらすと考える。
これが正しいと判断する指標は [指標] である。
```

### 例

**弱い**: "ボタン色を変えるとクリックが増えるかもしれない。"

**強い**: "ユーザーが CTA を見つけづらいという報告があるため（ヒートマップとフィードバックより）、ボタンを大きくし、コントラストの高い色にすることで、新規訪問者の CTA クリックが 15% 以上増えると考える。ページ表示からサインアップ開始までのクリック率を測定する。"

---

## テストの種類

| 種類 | 説明 | 必要トラフィック |
|------|-------------|----------------|
| A/B | 2 バージョン、単一変更 | 中程度 |
| A/B/n | 複数バリアント | より多い |
| MVT | 複数変更の組み合わせ | 非常に多い |
| URL 分割 | バリアントごとに別 URL | 中程度 |

---

## サンプルサイズ

### クイックリファレンス

| ベースライン | 10% リフト | 20% リフト | 50% リフト |
|----------|----------|----------|----------|
| 1% | 150k/バリアント | 39k/バリアント | 6k/バリアント |
| 3% | 47k/バリアント | 12k/バリアント | 2k/バリアント |
| 5% | 27k/バリアント | 7k/バリアント | 1.2k/バリアント |
| 10% | 12k/バリアント | 3k/バリアント | 550/バリアント |

**計算ツール:**
- [Evan Miller's](https://www.evanmiller.org/ab-testing/sample-size.html)
- [Optimizely's](https://www.optimizely.com/sample-size-calculator/)

**詳細なサンプルサイズ表と期間計算について**: [references/sample-size-guide.md](references/sample-size-guide.md) を参照

---

## 指標選定

### 主要指標
- 最も重要な単一指標
- 仮説に直接紐づく
- テスト判定に使う指標

### 副次指標
- 主要指標の解釈を補助する
- なぜ/どのように変更が効いたかを説明する

### ガードレール指標
- 悪化してはいけないもの
- 有意に悪化したらテストを停止する

### 例: 価格ページテスト
- **主要**: プラン選択率
- **副次**: ページ滞在時間、プラン分布
- **ガードレール**: サポートチケット数、返金率

---

## バリアント設計

### 何を変えるか

| カテゴリ | 例 |
|----------|----------|
| 見出し/コピー | メッセージ角度、価値提案、具体性、トーン |
| ビジュアルデザイン | レイアウト、色、画像、情報階層 |
| CTA | ボタン文言、サイズ、配置、数 |
| コンテンツ | 含める情報、順序、量、社会的証明 |

### ベストプラクティス
- 単一で意味のある変更
- 差が出るのに十分大胆であること
- 仮説に忠実であること

---

## トラフィック配分

| アプローチ | 配分 | 使用する場面 |
|----------|-------|-------------|
| 標準 | 50/50 | A/B のデフォルト |
| 保守的 | 90/10, 80/20 | 悪いバリアントのリスクを抑える |
| ランピング | 小さく始めて増やす | 技術的リスクの緩和 |

**考慮事項:**
- 一貫性: 再訪時も同じバリアントを表示する
- 時間帯/曜日をまたいで露出を均等にする

---

## 実装

### クライアントサイド
- JavaScript が読み込み後にページを変更する
- 実装は速いが、ちらつきが発生する可能性がある
- ツール: PostHog, Optimizely, VWO

### サーバーサイド
- 描画前にバリアントを決定する
- ちらつきなし、開発作業が必要
- ツール: PostHog, LaunchDarkly, Split

---

## テスト運用

### 事前チェックリスト
- [ ] 仮説が文書化されている
- [ ] 主要指標が定義されている
- [ ] サンプルサイズが計算されている
- [ ] バリアントが正しく実装されている
- [ ] トラッキングが検証されている
- [ ] すべてのバリアントで QA が完了している

### テスト中

**実施すること:**
- 技術的問題を監視する
- セグメント品質を確認する
- 外部要因を記録する

**実施しないこと:**
- 結果を覗き見して早期停止する
- バリアントを途中で変更する
- 新しい流入元のトラフィックを追加する

### 途中確認問題
サンプルサイズ到達前に結果を見て早期停止すると、偽陽性と誤った意思決定につながります。サンプルサイズを事前に確定し、プロセスを信頼してください。

---

## 結果分析

### 統計的有意性
- 95% 信頼水準 = p-value < 0.05
- 結果が偶然である確率が 5% 未満であることを意味する
- 保証ではなく、あくまで閾値

### 分析チェックリスト

1. **サンプルサイズに到達したか？** 未到達なら結果は暫定
2. **統計的に有意か？** 信頼区間を確認
3. **効果量に実務的意味があるか？** MDE と想定インパクトを比較
4. **副次指標は一貫しているか？** 主要指標を裏付けるか？
5. **ガードレール懸念はないか？** 何か悪化していないか？
6. **セグメント差はあるか？** モバイル vs デスクトップ？新規 vs リピーター？

### 結果の解釈

| 結果 | 結論 |
|--------|------------|
| 有意な勝者 | バリアントを実装 |
| 有意な敗者 | コントロール維持、理由を学ぶ |
| 有意差なし | 追加トラフィックか、より大胆なテストが必要 |
| シグナルが混在 | 深掘り、必要ならセグメント分析 |

---

## ドキュメント化

各テストで以下を記録する:
- 仮説
- バリアント（スクリーンショット付き）
- 結果（サンプル数、指標、有意性）
- 意思決定と学び

**テンプレートについて**: [references/test-templates.md](references/test-templates.md) を参照

---

## よくあるミス

### テスト設計
- 変化が小さすぎるテスト（検出不能）
- 要素を変えすぎるテスト（切り分け不能）
- 明確な仮説がない

### 実行
- 早期停止
- テスト途中で変更する
- 実装確認をしない

### 分析
- 信頼区間を無視する
- セグメントを都合よく切り取る
- 結論が出ない結果を過剰解釈する

---

## タスク固有の質問

1. 現在のコンバージョン率は？
2. このページのトラフィック量はどれくらい？
3. どんな変更を、なぜ検討していますか？
4. 検出したい最小改善幅は？
5. テストに使えるツールは？
6. この領域を以前にテストしたことはありますか？

---

## 関連スキル

- **page-cro**: CRO 原則に基づくテストアイデアの生成
- **analytics-tracking**: テスト計測の設定
- **copywriting**: バリアントコピーの作成
